# é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®æ•™ç¨‹

## ğŸ“‹ ç›®å½•
1. [é—®é¢˜è¯´æ˜](#é—®é¢˜è¯´æ˜)
2. [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
3. [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®](#é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®)
4. [GitHub Secrets é…ç½®](#github-secrets-é…ç½®)
5. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
6. [ä½¿ç”¨é•œåƒ](#ä½¿ç”¨é•œåƒ)

---

## é—®é¢˜è¯´æ˜

GitHub Actions åœ¨æ„å»º Docker é•œåƒæ—¶å‡ºç° 503 é”™è¯¯ï¼Œä¸»è¦åŸå› ï¼š
- ğŸŒ GitHub Actions æœåŠ¡å™¨è®¿é—®æŸäº›èµ„æºå¯èƒ½å—é™
- ğŸ“¦ npm åŒ…ä¸‹è½½é€Ÿåº¦æ…¢æˆ–è¿æ¥è¶…æ—¶
- ğŸ‹ Docker Hub æ‹‰å–åŸºç¡€é•œåƒé€Ÿåº¦æ…¢

## è§£å†³æ–¹æ¡ˆ

### âœ… å·²å®æ–½çš„ä¼˜åŒ–

1. **Dockerfile ä¼˜åŒ–**
   - ä½¿ç”¨é˜¿é‡Œäº‘ npm é•œåƒæº (`registry.npmmirror.com`)
   - åŠ é€Ÿ npm åŒ…ä¸‹è½½

2. **GitHub Actions ä¼˜åŒ–**
   - åŒæ—¶æ¨é€åˆ° GitHub Container Registry (ghcr.io) å’Œé˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
   - ä½¿ç”¨ Docker Buildx æé«˜æ„å»ºæ•ˆç‡
   - å¯ç”¨ GitHub Actions ç¼“å­˜åŠ é€Ÿæ„å»º
   - æ”¯æŒå¤šå¹³å°æ„å»º (amd64, arm64)

---

## é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œé˜¿é‡Œäº‘è´¦å·

1. è®¿é—® [é˜¿é‡Œäº‘å®˜ç½‘](https://www.aliyun.com/)
2. æ³¨å†Œå¹¶ç™»å½•è´¦å·
3. å®Œæˆå®åè®¤è¯ï¼ˆå¿…é¡»ï¼‰

### ç¬¬äºŒæ­¥ï¼šå¼€é€šå®¹å™¨é•œåƒæœåŠ¡

1. è®¿é—® [å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°](https://cr.console.aliyun.com/)
2. é€‰æ‹© **ä¸ªäººç‰ˆ**ï¼ˆå…è´¹ï¼Œé€‚åˆä¸ªäººé¡¹ç›®ï¼‰
3. è®¾ç½® Registry ç™»å½•å¯†ç ï¼ˆè®°ä½è¿™ä¸ªå¯†ç ï¼Œåé¢è¦ç”¨ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå‘½åç©ºé—´

1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **é»˜è®¤å®ä¾‹** â†’ **å‘½åç©ºé—´**
2. ç‚¹å‡» **åˆ›å»ºå‘½åç©ºé—´**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **å‘½åç©ºé—´åç§°**ï¼šä¾‹å¦‚ `my-projects` æˆ– `your-username`
   - **æ˜¯å¦å…¬å¼€**ï¼šé€‰æ‹© **å…¬å¼€** æˆ– **ç§æœ‰**ï¼ˆå»ºè®®ç§æœ‰ï¼‰
4. ç‚¹å‡» **ç¡®å®š**

### ç¬¬å››æ­¥ï¼šåˆ›å»ºé•œåƒä»“åº“ï¼ˆå¯é€‰ï¼‰

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼š

1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **é»˜è®¤å®ä¾‹** â†’ **é•œåƒä»“åº“**
2. ç‚¹å‡» **åˆ›å»ºé•œåƒä»“åº“**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **å‘½åç©ºé—´**ï¼šé€‰æ‹©åˆšæ‰åˆ›å»ºçš„å‘½åç©ºé—´
   - **ä»“åº“åç§°**ï¼š`ai-travel-planner`
   - **æ‘˜è¦**ï¼šAI æ—…è¡Œè§„åˆ’åº”ç”¨
   - **ä»“åº“ç±»å‹**ï¼šå…¬å¼€æˆ–ç§æœ‰
   - **ä»£ç æº**ï¼šæœ¬åœ°ä»“åº“
4. ç‚¹å‡» **ä¸‹ä¸€æ­¥** â†’ **åˆ›å»ºé•œåƒä»“åº“**

### ç¬¬äº”æ­¥ï¼šè·å–è®¿é—®å‡­è¯

éœ€è¦è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **Registry åœ°å€**ï¼š
   - åä¸œ1ï¼ˆæ­å·ï¼‰ï¼š`registry.cn-hangzhou.aliyuncs.com`
   - ååŒ—2ï¼ˆåŒ—äº¬ï¼‰ï¼š`registry.cn-beijing.aliyuncs.com`
   - åå—1ï¼ˆæ·±åœ³ï¼‰ï¼š`registry.cn-shenzhen.aliyuncs.com`
   - é€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸ

2. **ç”¨æˆ·å**ï¼š
   - åœ¨æ§åˆ¶å°å³ä¸Šè§’ç‚¹å‡»å¤´åƒ â†’ **è®¿é—®å‡­è¯**
   - æŸ¥çœ‹ **ç”¨æˆ·å**ï¼ˆé€šå¸¸æ˜¯ä½ çš„é˜¿é‡Œäº‘è´¦å· IDï¼‰

3. **å¯†ç **ï¼š
   - å°±æ˜¯ç¬¬äºŒæ­¥è®¾ç½®çš„ Registry ç™»å½•å¯†ç 
   - å¦‚æœå¿˜è®°äº†ï¼Œå¯ä»¥åœ¨ **è®¿é—®å‡­è¯** é¡µé¢é‡ç½®

---

## GitHub Secrets é…ç½®

### æ·»åŠ å¯†é’¥åˆ° GitHub ä»“åº“

1. æ‰“å¼€ä½ çš„ GitHub ä»“åº“
2. ç‚¹å‡» **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret**
4. æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ªå¯†é’¥ï¼š

#### Secret 1: ALIYUN_USERNAME
```
Name: ALIYUN_USERNAME
Secret: ä½ çš„é˜¿é‡Œäº‘ç”¨æˆ·åï¼ˆåœ¨è®¿é—®å‡­è¯é¡µé¢æŸ¥çœ‹ï¼‰
```

#### Secret 2: ALIYUN_PASSWORD
```
Name: ALIYUN_PASSWORD
Secret: ä½ çš„ Registry ç™»å½•å¯†ç 
```

#### Secret 3: ALIYUN_NAMESPACE
```
Name: ALIYUN_NAMESPACE
Secret: ä½ åˆ›å»ºçš„å‘½åç©ºé—´åç§°ï¼ˆä¾‹å¦‚ï¼šmy-projectsï¼‰
```

### ç¤ºä¾‹æˆªå›¾è¯´æ˜

æ·»åŠ å®Œæˆåï¼Œä½ åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ä¸‰ä¸ª secretsï¼š
- âœ… `ALIYUN_USERNAME`
- âœ… `ALIYUN_PASSWORD`
- âœ… `ALIYUN_NAMESPACE`

---

## éªŒè¯éƒ¨ç½²

### è§¦å‘ GitHub Actions

1. **æ–¹æ³•ä¸€ï¼šæ¨é€ä»£ç **
   ```bash
   git add .
   git commit -m "feat: é…ç½®é˜¿é‡Œäº‘é•œåƒæœåŠ¡"
   git push origin main
   ```

2. **æ–¹æ³•äºŒï¼šåˆ›å»ºæ ‡ç­¾**
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

### æŸ¥çœ‹æ„å»ºçŠ¶æ€

1. æ‰“å¼€ GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡ŒçŠ¶æ€
4. ç‚¹å‡»è¿›å…¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### æ„å»ºæˆåŠŸæ ‡å¿—

âœ… çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºæˆåŠŸï¼š
```
pushing manifest for ghcr.io/your-username/ai-travel-planner:latest
pushing manifest for registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-planner:latest
```

---

## ä½¿ç”¨é•œåƒ

### ä» GitHub æ‹‰å–é•œåƒ

```bash
# ç™»å½• GitHub Container Registry
docker login ghcr.io -u YOUR_GITHUB_USERNAME

# æ‹‰å–é•œåƒ
docker pull ghcr.io/YOUR_GITHUB_USERNAME/ai-travel-planner:latest

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:80 ghcr.io/YOUR_GITHUB_USERNAME/ai-travel-planner:latest
```

### ä»é˜¿é‡Œäº‘æ‹‰å–é•œåƒï¼ˆæ¨èï¼Œå›½å†…é€Ÿåº¦å¿«ï¼‰

```bash
# å¦‚æœæ˜¯å…¬å¼€ä»“åº“ï¼Œä¸éœ€è¦ç™»å½•
# å¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼Œéœ€è¦å…ˆç™»å½•
docker login registry.cn-hangzhou.aliyuncs.com -u YOUR_ALIYUN_USERNAME

# æ‹‰å–é•œåƒ
docker pull registry.cn-hangzhou.aliyuncs.com/YOUR_NAMESPACE/ai-travel-planner:latest

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:80 registry.cn-hangzhou.aliyuncs.com/YOUR_NAMESPACE/ai-travel-planner:latest
```

### ä½¿ç”¨ Docker Compose

æ›´æ–° `docker-compose.yml`ï¼š

```yaml
version: '3.8'

services:
  ai-travel-planner:
    # ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼ˆå›½å†…é€Ÿåº¦å¿«ï¼‰
    image: registry.cn-hangzhou.aliyuncs.com/YOUR_NAMESPACE/ai-travel-planner:latest
    # æˆ–ä½¿ç”¨ GitHub é•œåƒ
    # image: ghcr.io/YOUR_GITHUB_USERNAME/ai-travel-planner:latest
    ports:
      - "3000:80"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    container_name: ai-travel-planner
    networks:
      - travel-network

networks:
  travel-network:
    driver: bridge
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
docker-compose up -d
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: é˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€é€‰æ‹©å“ªä¸ªï¼Ÿ
**A:** é€‰æ‹©ç¦»ä½ æœåŠ¡å™¨æœ€è¿‘çš„åŒºåŸŸï¼š
- å›½å†…æ¨èï¼šæ­å·ã€åŒ—äº¬ã€æ·±åœ³
- æµ·å¤–å¯ä»¥ç»§ç»­ä½¿ç”¨ GitHub Container Registry

### Q2: å‘½åç©ºé—´å¯ä»¥åŒ…å«ä»€ä¹ˆå­—ç¬¦ï¼Ÿ
**A:** åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’ŒçŸ­æ¨ªçº¿(-)ï¼Œ2-30ä¸ªå­—ç¬¦

### Q3: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. GitHub Secrets æ˜¯å¦æ­£ç¡®é…ç½®
2. é˜¿é‡Œäº‘ Registry å¯†ç æ˜¯å¦æ­£ç¡®
3. å‘½åç©ºé—´åç§°æ˜¯å¦åŒ¹é…
4. æŸ¥çœ‹ Actions æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q4: å¦‚ä½•æŸ¥çœ‹å·²æ¨é€çš„é•œåƒï¼Ÿ
**A:** 
- **GitHub**: ä»“åº“é¡µé¢å³ä¾§ â†’ Packages
- **é˜¿é‡Œäº‘**: å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å° â†’ é•œåƒä»“åº“ â†’ é€‰æ‹©ä»“åº“ â†’ é•œåƒç‰ˆæœ¬

### Q5: å…è´¹é¢åº¦å¤Ÿç”¨å—ï¼Ÿ
**A:** 
- **GitHub**: å…¬å¼€ä»“åº“å…è´¹ï¼Œç§æœ‰ä»“åº“æœ‰å­˜å‚¨é™åˆ¶
- **é˜¿é‡Œäº‘ä¸ªäººç‰ˆ**: 
  - 3ä¸ªå‘½åç©ºé—´
  - 300ä¸ªä»“åº“
  - æ— é™åˆ¶çš„é•œåƒæ‹‰å–
  - å¯¹ä¸ªäººé¡¹ç›®å®Œå…¨å¤Ÿç”¨

---

## ğŸ‰ å®Œæˆ

ç°åœ¨ä½ çš„é¡¹ç›®å·²ç»é…ç½®å®Œæˆï¼š

âœ… Dockerfile ä½¿ç”¨é˜¿é‡Œäº‘ npm æºåŠ é€Ÿ
âœ… GitHub Actions è‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ°ä¸¤ä¸ªé•œåƒä»“åº“
âœ… æ”¯æŒå¤šå¹³å°é•œåƒ (amd64, arm64)
âœ… å¯ç”¨æ„å»ºç¼“å­˜æé«˜é€Ÿåº¦
âœ… å›½å†…å¯ä»¥å¿«é€Ÿæ‹‰å–é˜¿é‡Œäº‘é•œåƒ

æ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯æˆ–åˆ›å»º tagï¼Œéƒ½ä¼šè‡ªåŠ¨è§¦å‘æ„å»ºå’Œæ¨é€ï¼

---

## ğŸ“š ç›¸å…³é“¾æ¥

- [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ–‡æ¡£](https://help.aliyun.com/product/60716.html)
- [GitHub Container Registry æ–‡æ¡£](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [Docker Buildx æ–‡æ¡£](https://docs.docker.com/buildx/working-with-buildx/)

---

## ğŸ’¡ å»ºè®®

1. **å®šæœŸæ¸…ç†æ—§é•œåƒ**ï¼šèŠ‚çœå­˜å‚¨ç©ºé—´
2. **ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç‰ˆæœ¬**ï¼šä¾¿äºå›æ»š
3. **è®¾ç½®é•œåƒä»“åº“ä¸ºç§æœ‰**ï¼šä¿æŠ¤ä»£ç å®‰å…¨
4. **é…ç½®é•œåƒæ‰«æ**ï¼šæ£€æŸ¥å®‰å…¨æ¼æ´

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ GitHub Actions æ—¥å¿—æˆ–é˜¿é‡Œäº‘æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚
