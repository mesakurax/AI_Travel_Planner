# ğŸš€ é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®æŒ‡å—ï¼ˆä¸Šæµ·åŒºåŸŸï¼‰

## ğŸ“‹ é…ç½®æ¦‚è§ˆ

æœ¬é¡¹ç›®ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆä¸Šæµ·åŒºåŸŸï¼‰æ¥åŠ é€Ÿ Docker é•œåƒçš„æ„å»ºå’Œåˆ†å‘ã€‚

**åŒºåŸŸä¿¡æ¯ï¼š**
- **Registry åœ°å€**ï¼š`crpi-q6jikadfo82vknso.cn-shanghai.personal.cr.aliyuncs.com`
- **ç”¨æˆ·å**ï¼š`aliyun4121920273`
- **åŒºåŸŸåç§°**ï¼šåä¸œ2ï¼ˆä¸Šæµ·ï¼‰- ä¸ªäººå®ä¾‹
- **ä¼˜åŠ¿**ï¼šé€‚åˆåä¸œåœ°åŒºæœåŠ¡å™¨ï¼Œè®¿é—®é€Ÿåº¦å¿«

---

## âš¡ å¿«é€Ÿé…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé˜¿é‡Œäº‘é…ç½®

1. **è®¿é—®é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°**
   - åœ°å€ï¼š<https://cr.console.aliyun.com/>
   - é€‰æ‹©åŒºåŸŸï¼š**åä¸œ2ï¼ˆä¸Šæµ·ï¼‰**

2. **å¼€é€šæœåŠ¡å¹¶è®¾ç½®å¯†ç **
   - é¦–æ¬¡ä½¿ç”¨éœ€è¦å¼€é€šä¸ªäººç‰ˆæœåŠ¡ï¼ˆå…è´¹ï¼‰
   - è®¾ç½® Registry ç™»å½•å¯†ç ï¼ˆåŠ¡å¿…è®°ä½ï¼‰

3. **åˆ›å»ºå‘½åç©ºé—´**
   - å·¦ä¾§èœå•ï¼šé»˜è®¤å®ä¾‹ â†’ å‘½åç©ºé—´
   - ç‚¹å‡»"åˆ›å»ºå‘½åç©ºé—´"
   - å‘½åç©ºé—´åç§°ï¼šä¾‹å¦‚ `my-projects`ï¼ˆåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ï¼‰
   - è®¾ç½®ä¸ºç§æœ‰æˆ–å…¬å¼€ï¼ˆå»ºè®®ç§æœ‰ï¼‰

4. **è·å–è®¿é—®å‡­è¯**
   - ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ "è®¿é—®å‡­è¯"
   - è®°å½•ï¼š
     - **ç”¨æˆ·å**ï¼šé€šå¸¸æ˜¯ä½ çš„é˜¿é‡Œäº‘è´¦å· ID
     - **å¯†ç **ï¼šåˆšæ‰è®¾ç½®çš„ Registry ç™»å½•å¯†ç 

### ç¬¬äºŒæ­¥ï¼šGitHub Secrets é…ç½®

åœ¨ GitHub ä»“åº“ä¸­æ·»åŠ ä»¥ä¸‹ 3 ä¸ª Secretsï¼š

**è·¯å¾„**ï¼šä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

| Secret åç§° | å€¼ | è¯´æ˜ |
|------------|---|------|
| `ALIYUN_USERNAME` | ä½ çš„é˜¿é‡Œäº‘ç”¨æˆ·å | åœ¨"è®¿é—®å‡­è¯"é¡µé¢æŸ¥çœ‹ |
| `ALIYUN_PASSWORD` | Registry ç™»å½•å¯†ç  | ç¬¬ä¸€æ­¥è®¾ç½®çš„å¯†ç  |
| `ALIYUN_NAMESPACE` | å‘½åç©ºé—´åç§° | ä¾‹å¦‚ï¼š`my-projects` |

### ç¬¬ä¸‰æ­¥ï¼šæ¨é€ä»£ç è§¦å‘æ„å»º

```bash
git add .
git commit -m "feat: é…ç½®é˜¿é‡Œäº‘ä¸Šæµ·åŒºåŸŸé•œåƒæœåŠ¡"
git push origin main
```

---

## ğŸ¯ ä½¿ç”¨é•œåƒ

### ä»é˜¿é‡Œäº‘æ‹‰å–é•œåƒï¼ˆå›½å†…æ¨èï¼‰

```bash
# å¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼Œéœ€è¦å…ˆç™»å½•
docker login --username=aliyun4121920273 crpi-q6jikadfo82vknso.cn-shanghai.personal.cr.aliyuncs.com

# æ‹‰å–é•œåƒ
docker pull crpi-q6jikadfo82vknso.cn-shanghai.personal.cr.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/ai-travel-planner:latest

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:80 crpi-q6jikadfo82vknso.cn-shanghai.personal.cr.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/ai-travel-planner:latest
```

### ä» GitHub æ‹‰å–é•œåƒ

```bash
# æ‹‰å–é•œåƒ
docker pull ghcr.io/<ä½ çš„GitHubç”¨æˆ·å>/ai-travel-planner:latest

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:80 ghcr.io/<ä½ çš„GitHubç”¨æˆ·å>/ai-travel-planner:latest
```

### ä½¿ç”¨ Docker Compose

åˆ›å»ºæˆ–æ›´æ–° `docker-compose.yml`ï¼š

```yaml
version: '3.8'

services:
  ai-travel-planner:
    # ä½¿ç”¨é˜¿é‡Œäº‘ä¸Šæµ·åŒºåŸŸé•œåƒï¼ˆå›½å†…é€Ÿåº¦å¿«ï¼‰
    image: registry.cn-shanghai.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/ai-travel-planner:latest
    ports:
      - "3000:80"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    container_name: ai-travel-planner
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
docker-compose up -d
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### æŸ¥çœ‹æ„å»ºçŠ¶æ€

1. æ¨é€ä»£ç åï¼Œè®¿é—® GitHub Actions é¡µé¢
2. æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡ŒçŠ¶æ€
3. æˆåŠŸæ ‡å¿—ï¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—

```text
âœ… pushing manifest for ghcr.io/ä½ çš„ç”¨æˆ·å/ai-travel-planner:latest
âœ… pushing manifest for registry.cn-shanghai.aliyuncs.com/ä½ çš„å‘½åç©ºé—´/ai-travel-planner:latest
```

### æŸ¥çœ‹é•œåƒä»“åº“

**é˜¿é‡Œäº‘ï¼š**
- æ§åˆ¶å°ï¼š<https://cr.console.aliyun.com/>
- å·¦ä¾§èœå•ï¼šé»˜è®¤å®ä¾‹ â†’ é•œåƒä»“åº“
- æ‰¾åˆ° `ai-travel-planner` ä»“åº“æŸ¥çœ‹é•œåƒç‰ˆæœ¬

**GitHubï¼š**
- ä»“åº“é¡µé¢å³ä¾§ â†’ Packages
- æŸ¥çœ‹ `ai-travel-planner` åŒ…

---

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### Dockerfile ä¼˜åŒ–

```dockerfile
# ä½¿ç”¨é˜¿é‡Œäº‘ npm é•œåƒæºåŠ é€Ÿä¾èµ–å®‰è£…
RUN npm config set registry https://registry.npmmirror.com
```

è¿™æ ·å¯ä»¥é¿å… npm å®‰è£…æ—¶çš„ 503 é”™è¯¯ã€‚

### GitHub Actions Workflow

å…³é”®é…ç½®ç‚¹ï¼š

```yaml
env:
  # é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆä¸Šæµ·åŒºåŸŸï¼‰
  ALIYUN_REGISTRY: registry.cn-shanghai.aliyuncs.com
  ALIYUN_NAMESPACE: ${{ secrets.ALIYUN_NAMESPACE }}
  ALIYUN_IMAGE_NAME: ai-travel-planner
```

å·¥ä½œæµç¨‹ä¼šï¼š
1. âœ… ä½¿ç”¨é˜¿é‡Œäº‘ npm æºåŠ é€Ÿæ„å»º
2. âœ… æ„å»ºå¤šå¹³å°é•œåƒï¼ˆamd64, arm64ï¼‰
3. âœ… åŒæ—¶æ¨é€åˆ° GitHub å’Œé˜¿é‡Œäº‘ä¸Šæµ·åŒºåŸŸ
4. âœ… ä½¿ç”¨æ„å»ºç¼“å­˜åŠ é€Ÿåç»­æ„å»º

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹©ä¸Šæµ·åŒºåŸŸï¼Ÿ

**A:** 
- å¦‚æœä½ çš„æœåŠ¡å™¨åœ¨åä¸œåœ°åŒºï¼Œä¸Šæµ·åŒºåŸŸè®¿é—®é€Ÿåº¦æœ€å¿«
- å¦‚æœåœ¨å…¶ä»–åŒºåŸŸï¼Œå¯ä»¥é€‰æ‹©å¯¹åº”çš„åŒºåŸŸï¼š
  - ååŒ—ï¼š`registry.cn-beijing.aliyuncs.com`
  - åå—ï¼š`registry.cn-shenzhen.aliyuncs.com`
  - åä¸œï¼š`registry.cn-hangzhou.aliyuncs.com` æˆ– `registry.cn-shanghai.aliyuncs.com`

### Q2: æ„å»ºå¤±è´¥æç¤º "denied: requested access to the resource is denied"

**A:** 
- æ£€æŸ¥ GitHub Secrets ä¸­çš„ `ALIYUN_USERNAME` å’Œ `ALIYUN_PASSWORD` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å¯†ç æ˜¯ Registry ç™»å½•å¯†ç ï¼Œä¸æ˜¯é˜¿é‡Œäº‘è´¦å·å¯†ç 
- å¯ä»¥åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°"è®¿é—®å‡­è¯"é¡µé¢é‡ç½®å¯†ç 

### Q3: å‘½åç©ºé—´ä¸å­˜åœ¨é”™è¯¯

**A:**
- ç¡®ä¿ `ALIYUN_NAMESPACE` çš„å€¼ä¸é˜¿é‡Œäº‘åˆ›å»ºçš„å‘½åç©ºé—´åç§°å®Œå…¨ä¸€è‡´
- å‘½åç©ºé—´åç§°åŒºåˆ†å¤§å°å†™
- ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°ç¡®è®¤å‘½åç©ºé—´æ˜¯å¦å·²åˆ›å»º

### Q4: èƒ½å¦åŒæ—¶ä½¿ç”¨å¤šä¸ªåŒºåŸŸï¼Ÿ

**A:**
- å¯ä»¥ï¼Œä½†éœ€è¦ä¿®æ”¹ workflow é…ç½®
- å»ºè®®åªä½¿ç”¨ä¸€ä¸ªä¸»è¦åŒºåŸŸï¼Œé¿å…å¤æ‚åŒ–
- ä¸Šæµ·åŒºåŸŸå·²ç»èƒ½è¦†ç›–å¤§éƒ¨åˆ†å›½å†…éœ€æ±‚

### Q5: å¦‚ä½•åˆ‡æ¢åˆ°å…¶ä»–åŒºåŸŸï¼Ÿ

**A:**
å¦‚æœéœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åŒºåŸŸï¼Œåªéœ€ä¿®æ”¹ `.github/workflows/docker-build.yml` ä¸­çš„è¿™ä¸€è¡Œï¼š

```yaml
ALIYUN_REGISTRY: registry.cn-shanghai.aliyuncs.com
```

æ”¹ä¸ºå…¶ä»–åŒºåŸŸåœ°å€å³å¯ã€‚

---

## ğŸ‰ é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤åï¼Œä½ çš„é…ç½®å°±å®Œå…¨æ­£ç¡®äº†ï¼š

- [ ] é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡å·²å¼€é€šï¼ˆä¸Šæµ·åŒºåŸŸï¼‰
- [ ] è®¾ç½®äº† Registry ç™»å½•å¯†ç 
- [ ] åˆ›å»ºäº†å‘½åç©ºé—´
- [ ] è®°å½•äº†ç”¨æˆ·åå’Œå¯†ç 
- [ ] GitHub æ·»åŠ äº† 3 ä¸ª Secretsï¼ˆALIYUN_USERNAME, ALIYUN_PASSWORD, ALIYUN_NAMESPACEï¼‰
- [ ] æ¨é€ä»£ç åˆ° GitHub
- [ ] GitHub Actions æ„å»ºæˆåŠŸ
- [ ] åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°çœ‹åˆ°é•œåƒ
- [ ] èƒ½æˆåŠŸæ‹‰å–å’Œè¿è¡Œé•œåƒ

---

## ğŸ“š ç›¸å…³èµ„æº

- [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ–‡æ¡£](https://help.aliyun.com/product/60716.html)
- [GitHub Container Registry æ–‡æ¡£](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [Docker Buildx æ–‡æ¡£](https://docs.docker.com/buildx/working-with-buildx/)
- [é˜¿é‡Œäº‘å„åŒºåŸŸ Registry åœ°å€](https://help.aliyun.com/document_detail/60750.html)

---

## ğŸ’¡ ä¼˜åŠ¿æ€»ç»“

âœ… **è§£å†³ 503 é—®é¢˜** - ä½¿ç”¨é˜¿é‡Œäº‘ npm é•œåƒæº  
âœ… **åŠ é€Ÿå›½å†…è®¿é—®** - ä¸Šæµ·åŒºåŸŸåœ¨åä¸œåœ°åŒºé€Ÿåº¦æœ€å¿«  
âœ… **åŒä»“åº“æ¨é€** - åŒæ—¶æ¨é€åˆ° GitHub å’Œé˜¿é‡Œäº‘  
âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - æ¯æ¬¡æ¨é€è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ  
âœ… **å¤šå¹³å°æ”¯æŒ** - æ”¯æŒ amd64 å’Œ arm64 æ¶æ„  
âœ… **æ„å»ºç¼“å­˜** - åŠ é€Ÿåç»­æ„å»ºé€Ÿåº¦  

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸŠ
